(function($){$.fn.roto=function(options){var defaults={btnPrev:".prev",btnNext:".next",direction:"h",speed:200,shift_easing:null,drift_easing:"easeOutCubic",bounce_easing:"easeOutElastic",drift_factor:500,drift_duration:1750,pull_amount:200,bounce_duration:1800,timer_interval:50};options=$.extend(defaults,options||{});options.drift_easing=(typeof jQuery.easing[options.drift_easing]==="function")?options.drift_easing:"linear";options.bounce_easing=(typeof jQuery.easing[options.bounce_easing]==="function")?options.bounce_easing:"linear";var isTouchDevice=function(){try{document.createEvent("TouchEvent");return true}catch(e){return false}};var wrapScrollEvent=function(e){if(isTouchDevice()){return e.originalEvent.touches[0]}return e};return this.each(function(){var orientations={h:{measure:"Width",offsetName:"left",coOrd:"X"},v:{measure:"Height",offsetName:"top",coOrd:"Y"}},dimensions=orientations[options.direction],scrollEvents=isTouchDevice()?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},container=this,ul=$(container).find("ul").first(),listElements=ul.find("li"),maxOffset=0,minOffset=0,currentOffset=maxOffset,containerMeasure=0,rotoMeasure=0,containerId=(typeof $(container).attr("id")!==undefined)?$(container).attr("id"):new Date().getTime()+"",running=false,prevButton=$(container).find(options.btnPrev),nextButton=$(container).find(options.btnNext);if(prevButton.length===0&&options.btnPrev===defaults.btnPrev){if($(container).attr("id")){prevButton=$("#"+$(container).attr("id")+"-prev");nextButton=$("#"+$(container).attr("id")+"-next")}}var remeasure=function(){containerMeasure=Math.ceil(ul.parent()[dimensions.measure.toLowerCase()]()),minOffset=Math.ceil(rotoMeasure-containerMeasure)*-1};var switchButtons=function(){if(rotoMeasure>(containerMeasure-currentOffset)){nextButton.removeAttr("disabled")}else nextButton.attr("disabled","disabled");if(currentOffset<maxOffset){prevButton.removeAttr("disabled")}else prevButton.attr("disabled","disabled")};var rotoShift=function(dir){if(running)return;running=true;var doShift=function(move){var opt={};opt[dimensions.offsetName]=move;ul.animate(opt,options.speed,options.shift_easing,function(){currentOffset=move;switchButtons();running=false})};var getNearestVisibleListElement=function(offset){var pos=0,li=listElements.get(0);$.each(listElements,function(idx,el){pos=-1*Math.ceil($(el).position()[dimensions.offsetName]);if(pos<offset){return false}li=el});return li};switch(dir){case'prev':var offsetElement=getNearestVisibleListElement(currentOffset+containerMeasure);break;case'next':var offsetElement=getNearestVisibleListElement(currentOffset-containerMeasure);break}var newOffset=Math.ceil($(offsetElement).position()[dimensions.offsetName]);var move=-1*(containerMeasure-(containerMeasure-newOffset));doShift(move)};var rotoTrack=function(pointerMove){var move=Math.ceil(pointerMove+currentOffset);if(move<(maxOffset+options.pull_amount)&&move>(minOffset-options.pull_amount))ul.css(dimensions.offsetName,move)};var timer=function(){var startCoOrd=0,currentCoOrd=0,chunker=null,chunk={startCoOrd:0,endCoOrd:0};return{start:function(){startCoOrd=currentCoOrd;chunker=window.setInterval(function(){chunk.startCoOrd=startCoOrd;chunk.endCoOrd=currentCoOrd;startCoOrd=currentCoOrd},options.timer_interval)},stop:function(){clearInterval(chunker);endCoOrd=currentCoOrd},getPointerSpeed:function(){var translation=chunk.endCoOrd-chunk.startCoOrd,distance=Math.abs(translation),speed=distance/options.timer_interval,dir=translation<0?-1:1;return[speed,dir]},setCurrentCoOrd:function(coOrd){currentCoOrd=coOrd}}}();var drift=function(){var speed_dir=timer.getPointerSpeed(),speed=speed_dir[0],dir=speed_dir[1];if(speed===0)return;var distance=speed*options.drift_factor*dir,move=distance+currentOffset;if(move>maxOffset)move=maxOffset;if(move<minOffset)move=minOffset;var opt={};opt[dimensions.offsetName]=move;ul.animate(opt,options.drift_duration,options.drift_easing,function(){if(ul.position()[dimensions.offsetName]>maxOffset){bounceBack()}else{currentOffset=ul.position()[dimensions.offsetName]}switchButtons()})};var bounceBack=function(dir){var end=dir?minOffset:maxOffset,opt={};opt[dimensions.offsetName]=end;ul.animate(opt,options.bounce_duration,options.bounce_easing,function(){currentOffset=end;switchButtons()})};$(window).resize(function(){containerMeasure=ul.parent()[dimensions.measure.toLowerCase()](),remeasure();switchButtons()});ul.bind(scrollEvents.start+".roto."+containerId,function(e){switchButtons();var linkElements=ul.find("a"),oldLinkEvents={};if(!isTouchDevice()){e.preventDefault();if(linkElements.length>0){$(window).one(scrollEvents.move+".roto."+containerId,function(f){linkElements.one("click.roto."+containerId,function(f){f.preventDefault()});$.each(linkElements.data('events'),function(eventName,events){oldLinkEvents[eventName]=[];$.each(events,function(i,event){oldLinkEvents[eventName].push(event)})});linkElements.unbind();linkElements.bind("click.roto."+containerId,function(g){g.preventDefault()})})}}e=wrapScrollEvent(e);var startCoOrd=e["screen"+dimensions.coOrd];ul.stop();currentOffset=ul.position()[dimensions.offsetName];timer.setCurrentCoOrd(startCoOrd);$(window).bind(scrollEvents.move+".roto."+containerId,function(f){f.preventDefault();f=wrapScrollEvent(f);timer.setCurrentCoOrd(f["screen"+dimensions.coOrd]);rotoTrack(f["screen"+dimensions.coOrd]-startCoOrd)});$(window).bind(scrollEvents.end+".roto."+containerId,function(){timer.stop();currentOffset=ul.position()[dimensions.offsetName];if(currentOffset>maxOffset||currentOffset<minOffset){bounceBack(currentOffset<minOffset)}else{drift()}$(window).unbind(scrollEvents.move+".roto."+containerId);$(window).unbind(scrollEvents.end+".roto."+containerId);if(!isTouchDevice()&&linkElements.length>0){window.setTimeout(function(){linkElements.unbind("click.roto."+containerId);$.each(oldLinkEvents,function(eventName,events){$.each(events,function(f,event){linkElements.bind(event.type+"."+event.namespace,event.data,event.handler)})})},250)}});timer.start()});if(options.btnPrev){prevButton.click(function(){return rotoShift("prev")})}if(options.btnNext){nextButton.click(function(){return rotoShift("next")})}$(container).css({overflow:"hidden",position:"relative"});ul.css({position:"relative",whiteSpace:"nowrap",padding:0,margin:0});listElements.css({display:"block",float:"left",listStyle:"none"});if(options.direction==='h'){listElements.each(function(idx,el){rotoMeasure+=Math.ceil($(el)["outer"+dimensions.measure](true))});ul[dimensions.measure.toLowerCase()](rotoMeasure+(Math.ceil(rotoMeasure/100)))}else{var last=listElements.last();rotoMeasure=Math.round($(last).position()[dimensions.offsetName]+$(last)["outer"+dimensions.measure](true))}if(rotoMeasure<=containerMeasure){if(options.btnPrev){prevButton.hide()}if(options.btnNext){nextButton.hide()}return}remeasure();switchButtons()})}})(jQuery);